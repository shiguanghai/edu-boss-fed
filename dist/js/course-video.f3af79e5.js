(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["course-video"],{"1f26":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("el-card",[n("div",{attrs:{slot:"header"},slot:"header"},[n("div",[e._v("课程："+e._s(e.courseName))]),n("div",[e._v("阶段："+e._s(e.sectionName))]),n("div",[e._v("课时："+e._s(e.lessonName))])]),n("el-form",{attrs:{"label-width":"80px"}},[n("el-form-item",{attrs:{label:"视频上传"}},[n("input",{ref:"video-file",attrs:{type:"file"}})]),n("el-form-item",{attrs:{label:"封面上传"}},[n("input",{ref:"image-file",attrs:{type:"file"}})]),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.handleUpload}},[e._v("开始上传")]),n("el-button",{on:{click:function(t){return e.$router.back()}}},[e._v("返回")])],1),n("el-form-item",[n("p",[e._v("视频上传中："+e._s(e.uploadPercent)+"%")]),e.isUploadSuccess?n("p",[e._v("视频转码中："+e._s(e.isTransCodeSuccess?"完成":"正在处理，请稍后"))]):e._e()])],1)],1)],1)},r=[],a=n("1da1"),s=(n("b0c0"),n("96cf"),n("2b0e")),u=n("b32d"),c=function(e){return Object(u["a"])({method:"GET",url:"/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json",params:e})},d=function(){return Object(u["a"])({method:"GET",url:"/boss/course/upload/aliyunImagUploadAddressAdnAuth.json"})},i=function(e){return Object(u["a"])({method:"POST",url:"/boss/course/upload/aliyunTransCode.json",data:e})},l=function(e){return Object(u["a"])({method:"GET",url:"/boss/course/upload/aliyunTransCodePercent.json",params:{lessonId:e}})},f=n("49e4"),p=n("2e4c"),m=n("6fd8"),b=s["default"].extend({name:"CourseVideo",data:function(){return{uploader:null,imageURL:"",videoId:null,uploadPercent:0,isUploadSuccess:!1,isTransCodeSuccess:!1,lessonName:null,sectionName:null,courseName:null}},computed:{video:function(){return this.$refs["video-file"]},image:function(){return this.$refs["image-file"]}},created:function(){this.initUploader(),this.loadHeadTitle()},methods:{loadHeadTitle:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,o,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(f["a"])(e.$route.query.lessonId);case 2:return n=t.sent,o=n.data,e.lessonName=o.data.theme,t.next=7,Object(p["b"])(o.data.sectionId);case 7:return r=t.sent,e.sectionName=r.data.data.sectionName,t.next=11,Object(m["b"])(o.data.courseId);case 11:a=t.sent,e.courseName=a.data.data.courseName;case 13:case"end":return t.stop()}}),t)})))()},initUploader:function(){var e=this;this.uploader=new window.AliyunUpload.Vod({userId:"1618139964448548",region:"",partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){var o,r,a,s,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("onUploadstarted",n),!n.isImage){t.next=10;break}return t.next=4,d();case 4:r=t.sent,a=r.data,o=a.data,e.imageURL=o.imageURL,t.next=16;break;case 10:return t.next=12,c({fileName:n.file.name,imageUrl:e.imageURL});case 12:s=t.sent,u=s.data,o=u.data,e.videoId=o.videoId;case 16:e.uploader.setUploadAuthAndAddress(n,o.uploadAuth,o.uploadAddress,o.imageId||o.videoId);case 17:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),onUploadSucceed:function(e){console.log("onUploadSucceed",e)},onUploadFailed:function(e,t,n){console.log("onUploadFailed",e,t,n)},onUploadProgress:function(t,n,o){console.log("onUploadProgress",t,n,o),t.isImage||(e.uploadPercent=Math.floor(100*o))},onUploadTokenExpired:function(e){console.log("onUploadTokenExpired",e)},onUploadEnd:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){var o,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("onUploadEnd",n),e.isUploadSuccess=!0,t.next=4,i({lessonId:e.$route.query.lessonId,coverImageUrl:e.imageURL,fileName:e.video.files[0].name,fileId:e.videoId});case 4:o=t.sent,r=o.data,console.log(r),s=setInterval(Object(a["a"])(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l(e.$route.query.lessonId);case 2:n=t.sent,o=n.data,console.log(o.data),100===o.data&&(e.isTransCodeSuccess=!0,window.clearInterval(s),console.log("转码成功"));case 6:case"end":return t.stop()}}),t)}))),3e3);case 8:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()})},handleUpload:function(){this.isUploadSuccess=!1,this.isTransCodeSuccess=!1,this.uploadPercent=0;var e=this.image.files[0],t=this.video.files[0],n=this.uploader;n.addFile(e,null,null,null,'{"Vod":{}}'),n.addFile(t,null,null,null,'{"Vod":{}}'),n.startUpload()}}}),h=b,v=n("2877"),g=Object(v["a"])(h,o,r,!1,null,"70a9a4c0",null);t["default"]=g.exports},"2e4c":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return s}));var o=n("b32d"),r=function(e){return Object(o["a"])({method:"GET",url:"/boss/course/section/getSectionAndLesson",params:{courseId:e}})},a=function(e){return Object(o["a"])({method:"POST",url:"/boss/course/section/saveOrUpdateSection",data:e})},s=function(e){return Object(o["a"])({method:"GET",url:"/boss/course/section/getBySectionId",params:{sectionId:e}})}},"49e4":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a}));var o=n("b32d"),r=function(e){return Object(o["a"])({method:"POST",url:"/boss/course/lesson/saveOrUpdate",data:e})},a=function(e){return Object(o["a"])({method:"GET",url:"/boss/course/lesson/getById",params:{lessonId:e}})}},"6fd8":function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"b",(function(){return c}));var o=n("b32d"),r=function(e){return Object(o["a"])({method:"POST",url:"/boss/course/getQueryCourses",data:e})},a=function(e){return Object(o["a"])({method:"GET",url:"/boss/course/changeState",params:e})},s=function(e){return Object(o["a"])({method:"POST",url:"/boss/course/saveOrUpdateCourse",data:e})},u=function(e,t){return Object(o["a"])({method:"POST",url:"/boss/course/upload",data:e,onUploadProgress:t})},c=function(e){return Object(o["a"])({method:"GET",url:"/boss/course/getCourseById",params:{courseId:e}})}},b0c0:function(e,t,n){var o=n("83ab"),r=n("9bf2").f,a=Function.prototype,s=a.toString,u=/^\s*function ([^ (]*)/,c="name";o&&!(c in a)&&r(a,c,{configurable:!0,get:function(){try{return s.call(this).match(u)[1]}catch(e){return""}}})}}]);
//# sourceMappingURL=course-video.f3af79e5.js.map